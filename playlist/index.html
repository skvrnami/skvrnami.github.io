<html>
<head>
    <title>The Worst Thing Ever to Happen to Music</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans&display=swap" rel="stylesheet"> 
    <script src=papaparse.min.js></script> 
    <script>
    
    function getRandomSubarray(arr, size) {
        var shuffled = arr.slice(0), i = arr.length, temp, index;
        while (i--) {
            index = Math.floor((i + 1) * Math.random());
            temp = shuffled[index][1];
            shuffled[index] = shuffled[i];
            shuffled[i] = temp;
        }
        return shuffled.slice(0, size);
    };

    function removePreviousList() {
        var elem = document.getElementsByTagName("ul");
        if(elem.length > 0){
            elem[0].parentNode.removeChild(elem[0])
        }
    };

    function appendPlaylist(arr, playlistId){
        removePreviousList();

        var ul = document.createElement("ul");
        document.getElementById(playlistId).appendChild(ul)

        for (i = 0; i < arr.length; i++) {
            var node = document.createElement("li");
            
            //var textnode = document.createTextNode(arr[i]);
            //node.appendChild(textnode);
            //document.getElementsByTagName("ul")[0].appendChild(node);

            var a = document.createElement('a');
            var linkText = document.createTextNode(arr[i]);
            a.appendChild(linkText);
            a.title = arr[i];
            a.href = "https://www.youtube.com/results?search_query=" + arr[i];
            a.target = "_blank";
            document.getElementsByTagName("ul")[0].appendChild(node).appendChild(a);

        };
    };

    function generatePlaylist() {

        Papa.parse("sample-data-min2.csv", {
        download: true,
        complete: function(results, file) {

            var n = parseInt(document.getElementById("tracks").value)
            var stations = [];
            if(document.getElementById("RZ").checked){
                stations.push("radiozurnal")
            }

            if(document.getElementById("DJ").checked){
                stations.push("dvojka")
            }

            if(document.getElementById("RW").checked){
                stations.push("radiowave")
            }

            if(document.getElementById("JAZZ").checked){
                stations.push("jazz")
            }

            if(document.getElementById("JUNIOR").checked){
                stations.push("radiojunior")
            }

            if(document.getElementById("REGION").checked){
                stations.push("region")
            }

            var filteredData = results["data"].filter(function(x) {return stations.indexOf(x[0]) >= 0})
            var playlist = getRandomSubarray(filteredData, n);

            appendPlaylist(playlist, "playlist");
            
        }})
    };
    </script>
</head>
<body>
    <div class="content">
        <div class="box">
        <h1>The Worst Thing Ever to Happen to Music</h1>
        <p>Vygeneruj si náhodný playlist ze skladeb, které zazněly ve vysílání stanic Českého rozhlasu mezi&nbsp;1.&nbsp;lednem a 1. zářím 2019. Aspoň podle dat dostupných <a href="https://data.irozhlas.cz/opendata/">tady</a>.</p>
        <p><i>"The worst thing ever to happen to music"</i> je jedno z označení žánru, který podle <a href="https://www.last.fm/">last.fm</a> provozuje Helena Vondráčková. A generování náhodných playlistů ze skladeb hraných na stanicích ČRo asi taky není nejlepší nápad. Ale co už. </p>
        </div>
        <div class="box">
            <form>
                <p>
                <b>Počet skladeb:</b><br>
                <input type="number" value="8" id="tracks"><br>
                </p>
                <p>
                <b>Stanice:</b><br>
                    <table>
                        <tr>
                            <td>
                            <input type="checkbox" id="RZ" value="radiozurnal">Radiožurnál
                            </td>
                            <td>
                            <input type="checkbox" id="DJ" value="dvojka">Dvojka
                            </td>
                            <td> 
                            <input type="checkbox" id="RW" value="radiowave" checked>Radio Wave
                            </td>
                        </tr>
                        <tr>
                            <td>
                            <input type="checkbox" id="JAZZ" value="jazz">Jazz
                            </td>
                            <td>
                            <input type="checkbox" id="JUNIOR" value="radiojunior">Junior
                            </td>
                            <td>
                            <input type="checkbox" id="REGION" value="region">Regionální stanice
                            </td>
                        </tr>
                    </table>
                </form>
                </p>
                <button onclick="generatePlaylist();">Vygeneruj playlist</button>
        </div>
        <div class="box" id="playlist">
        </div>
        <div class="box" id="footer">
        <p>vytvořeno <a href="https://twitter.com/skvrnami/">@skvrnami</a> na <a href="https://hackujstat.cz/">#hackujstat</a></p>
    </div>
    </div>
    
</body>

</html>